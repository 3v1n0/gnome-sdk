name: gnome-3-28-1804-sdk
version: 3.28.0
summary: Shared GNOME 3.28 Ubuntu stack
summary: Library bundle for developers of GNOME applications
description: |
 This snap contains only the necessary libraries required by
 GNOME applications.

confinement: strict
grade: stable

# the recommended mountpoint for that content is /gnome-platform
slots:
    gnome-3.28-1804:
      interface: content
      read:
        - /

parts:
  #libtool: 
  #  plugin: autotools
  #  source: https://git.savannah.gnu.org/git/libtool.git
  #  configflags: [ --prefix=/usr ]
  #  build-packages:
  #    - file
  #    - automake
  #    - autoconf
  #    - autotools-dev
  #    - help2man
  #    - texinfo
  #    - zlib1g-dev
  #    - gnulib
  meson:
    plugin: python
    source: https://github.com/mesonbuild/meson.git
    source-tag: 0.45.0
    build-packages:
      - ninja-build
  vala:
    after: [gobject-introspection]
    plugin: autotools
    source: https://github.com/GNOME/vala.git
    source-tag: '0.40.0'
    # Once the 0.40 branch exists, we should track the branch rather than the tag
    #source-branch: 0.40
    configflags: [ --prefix=/usr ]
    build-packages:
      - bison
      - flex
      - help2man
      - xsltproc
      - libdbus-1-dev
      - dbus
      - valac
      - libgraphviz-dev
  gobject-introspection:
    after: [glib]
    source: https://gitlab.gnome.org/GNOME/gobject-introspection.git
    source-branch: gnome-3-28
    plugin: autotools
    configflags: [ --prefix=/usr, --with-python=python3 ]
    install: |
      set -eux
      SCANNER=$SNAPCRAFT_PART_INSTALL/usr/bin/g-ir-scanner
      sed -i 's#/usr/lib#$SNAPCRAFT_STAGE/usr/lib#' $SCANNER
      sed -i 's#/usr/share#$SNAPCRAFT_STAGE/usr/share#' $SCANNER
    build-packages:
      - python3-dev
      - libcairo2-dev
      - libffi-dev
      - python3-mako
      - bison
      - flex
  atk:
    after: [glib]
    source: https://git.gnome.org/browse/atk.git
    source-branch: gnome-3-28
    plugin: autotools
    configflags: [ --prefix=/usr ]
  at-spi2-core:
    after: [glib, gobject-introspection, meson]
    source: https://git.gnome.org/browse/at-spi2-core.git
    source-tag: AT_SPI2_CORE_2_28_0
    plugin: meson
    meson-parameters: [ --prefix=/usr ]
    install: |
      set -eux
      PKGCONFIG_BUILD=$SNAPCRAFT_STAGE/pkgconfig-build
      mkdir -p $PKGCONFIG_BUILD
      PC=atspi-2.pc
      SRC=$SNAPCRAFT_PART_INSTALL/usr/lib/$(gcc -print-multiarch)/pkgconfig/$PC
      DST=$PKGCONFIG_BUILD/$PC
      cp $SRC $DST
      sed -i 's#libdir=#libdir=$SNAPCRAFT_STAGE#' $DST
      sed -i 's#includedir=#includedir=$SNAPCRAFT_STAGE#' $DST
    build-packages:
      - libdbus-1-dev
      - libxkbcommon-x11-dev
      - libxkbcommon-dev
      - libxtst-dev
  at-spi2-atk:
    after: [glib, at-spi2-core, atk, meson]
    source: https://git.gnome.org/browse/at-spi2-atk.git
    source-branch: gnome-3-26 # there is no gnome-3-28 branch yet
    plugin: meson
    meson-parameters: [ --prefix=/usr ]
    install: |
      set -eux
      PKGCONFIG_BUILD=$SNAPCRAFT_STAGE/pkgconfig-build
      mkdir -p $PKGCONFIG_BUILD
      PC=atk-bridge-2.0.pc
      SRC=$SNAPCRAFT_PART_INSTALL/usr/lib/$(gcc -print-multiarch)/pkgconfig/$PC
      DST=$PKGCONFIG_BUILD/$PC
      cp $SRC $DST
      sed -i 's#libdir=#libdir=$SNAPCRAFT_STAGE#' $DST
      sed -i 's#includedir=#includedir=$SNAPCRAFT_STAGE#' $DST
    build-packages:
      - libdbus-1-dev
      - libdbus-glib-1-dev
      - libxml2-dev
      - libx11-dev
  gdk-pixbuf:
    after: [glib, gobject-introspection]
    source: https://git.gnome.org/browse/gdk-pixbuf.git
    source-tag: 2.36.11 # there is no gdk-pixbuf-2-36 branch yet
    plugin: meson
    meson-parameters: [ --prefix=/usr ]
    install: |
      set -eux
      PKGCONFIG_BUILD=$SNAPCRAFT_STAGE/pkgconfig-build
      mkdir -p $PKGCONFIG_BUILD
      PC=gdk-pixbuf-2.0.pc
      SRC=$SNAPCRAFT_PART_INSTALL/usr/lib/$(gcc -print-multiarch)/pkgconfig/$PC
      DST=$PKGCONFIG_BUILD/$PC
      cp $SRC $DST
      sed -i 's#libdir=#libdir=$SNAPCRAFT_STAGE#' $DST
      sed -i 's#includedir=#includedir=$SNAPCRAFT_STAGE#' $DST
    build-packages:
      - libx11-dev
      - libpng-dev
      - libjpeg-dev
      - libtiff-dev
  gtk:
    after: [glib, gobject-introspection, gdk-pixbuf, json-glib, atk, at-spi2-atk]
    source: https://gitlab.gnome.org/GNOME/gtk.git
    source-branch: gtk-3-22
    plugin: autotools
    configflags: [ --prefix=/usr ]
    build-packages:
      - libtool
      - gtk-doc-tools
      - gettext
      - dbus-x11
      - libpango1.0-dev
      - libegl1-mesa-dev
      - libepoxy-dev
      - libwayland-dev
      - libxkbcommon-dev
      - libx11-dev
      - libxext-dev
      - libxi-dev
      - libxrandr-dev
      - libxt-dev
      - libxrender-dev
      - libxft-dev
      - libxcursor-dev
      - libxcomposite-dev
      - libxdamage-dev
      - libxkbfile-dev
      - libxinerama-dev
      - libxfixes-dev
      - libcairo2-dev
      - x11proto-xext-dev
      - libcups2-dev
      - libcolord-dev
      - librest-dev
      - xvfb
  gee: 
    after: [vala, gobject-introspection]
    source: git://git.gnome.org/libgee
    source-tag: '0.20.1'
    # Once the 0.40 branch exists, we should track the branch rather than the tag
    #source-branch: 0.20
    configflags: [ --prefix=/usr ]
    plugin: autotools
    build-packages:
      - autoconf-archive
  glib: 
    source: https://gitlab.gnome.org/GNOME/glib.git
    source-branch: glib-2-56
    configflags: [ --prefix=/usr ]
    plugin: autotools
    build-packages:
      - automake
      - autoconf
      - autotools-dev
      - libtool
      - libmount-dev
  #pango: 
    #after: [glib]
    #source: git://git.gnome.org/pango
    #source-tag: '1.42.0'
    #configflags: [ --prefix=/usr ]
    #plugin: autotools
    #build-packages:
    # - libcairo2-dev
    # - libharfbuzz-dev
    # - libfreetype6-dev
    # - libfontconfig1-dev
    # - libx11-dev
    # - libxft-dev
    # - libxrender-dev
    # - libxt-dev
    # - fonts-cantarell
    # - gtk-doc-tools
    # - gnome-pkg-tools
    # - libthai-dev
    # - perl
  libcanberra: 
    after: [glib, gtk]
    source: git://git.0pointer.net/libcanberra.git
    configflags: [ --prefix=/usr ]
    plugin: autotools
    build-packages:
      - libasound2-dev
      - libvorbis-dev
      - libx11-dev
      - libtdb-dev
      - libpulse-dev
      - libgstreamer1.0-dev
  json-glib: 
    after: [glib, meson]
    source: https://gitlab.gnome.org/GNOME/json-glib.git
    source-branch: json-glib-1-4
    plugin: meson
    meson-parameters: [ --prefix=/usr ]
